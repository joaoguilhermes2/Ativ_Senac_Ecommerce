<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <title>Carrinho - Senac Commerce</title>
  <link rel="stylesheet" href="../Assets/Css/index.css">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>

  <header>
    <div class="logo">Senac<span>Ecommerce</span></div>
    <button class="menu-toggle" id="menuToggle">&#9776;</button>
    <nav class="nav-menu" id="navMenu">
      <a href="../index.html">Home</a>
      <a href="produtos.html">Produtos</a>
      <a href="carrinho.html">Carrinho</a>
      <a href="usuario.html">Usuário</a>
      <a href="favoritos.html">Favoritos</a>
      <a href="login.html">Login</a>
    </nav>
  </header>

  <main>
    <h1>Carrinho de Compras</h1>
  <div id="carrinho-itens"></div>

  <form class="form-endereco" onsubmit="finalizarCompra(); return false;">
    <h3>Endereço de Entrega</h3>

    <label for="cep">CEP:</label>
    <input type="text" id="cep" onblur="buscarCEP()" required>

    <label for="logradouro">Logradouro:</label>
    <input type="text" id="logradouro" required>

    <label for="cidade">Cidade:</label>
    <input type="text" id="cidade" required>

    <label for="estado">Estado:</label>
    <input type="text" id="estado" required>

    <button type="submit">Finalizar Compra</button>
  </form>
  </main>
  <script>
    // Exemplo de produtos no carrinho (substituir com sessionStorage ou localStorage em projeto real)
    const carrinho = JSON.parse(localStorage.getItem('carrinho')) || [
      { id: 1, nome: 'Camisa Azul', preco: 79.90, quantidade: 1 },
      { id: 2, nome: 'Tênis Preto', preco: 199.90, quantidade: 2 }
    ];
  
    function mostrarCarrinho() {
      const div = document.getElementById('carrinho-itens');
      if (carrinho.length === 0) {
        div.innerHTML = '<p>Seu carrinho está vazio.</p>';
        return;
      }
  
      div.innerHTML = carrinho.map(item => `
        <div class="card">
          <h3>${item.nome}</h3>
          <p>Preço: R$ ${item.preco.toFixed(2)}</p>
          <label>Quantidade:
            <input type="number" value="${item.quantidade}" min="1"
              onchange="atualizarQuantidade(${item.id}, this.value)">
          </label>
        </div>
      `).join('');
    }
  
    function atualizarQuantidade(id, novaQtd) {
      const produto = carrinho.find(p => p.id === id);
      if (produto) {
        produto.quantidade = parseInt(novaQtd);
        localStorage.setItem('carrinho', JSON.stringify(carrinho));
      }
    }
  
    function buscarCEP() {
      const cep = document.getElementById('cep').value.replace(/\D/g, '');
      if (cep.length !== 8) {
        alert('CEP inválido!');
        return;
      }
  
      fetch(`https://viacep.com.br/ws/${cep}/json/`)
        .then(res => res.json())
        .then(dados => {
          if (dados.erro) throw new Error('CEP não encontrado');
          document.getElementById('logradouro').value = dados.logradouro;
          document.getElementById('cidade').value = dados.localidade;
          document.getElementById('estado').value = dados.uf;
        })
        .catch(() => alert('Erro ao buscar CEP.'));
    }
  
    function finalizarCompra() {
      const token = sessionStorage.getItem('token');
      if (!token) {
        alert('Você precisa estar logado para finalizar a compra.');
        window.location.href = 'login.html';
        return;
      }
  
      const endereco = {
        cep: document.getElementById('cep').value,
        logradouro: document.getElementById('logradouro').value,
        cidade: document.getElementById('cidade').value,
        estado: document.getElementById('estado').value
      };
  
      // Simulação de envio dos dados
      console.log('Compra finalizada:', {
        usuario: token,
        endereco,
        carrinho
      });
  
      alert('Compra finalizada com sucesso!');
      localStorage.removeItem('carrinho');
      window.location.href = 'index.html';
    }
  
    // Iniciar a exibição do carrinho
    mostrarCarrinho();
  </script>

  <script src="js/menu.js"></script>
</body>
</html>
